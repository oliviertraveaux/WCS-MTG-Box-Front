<div class="flex h-full w-full flex-col px-4 sm:px-8 lg:px-0 lg:py-2">
    <div class="flex flex-col sm:flex-row">
        <mat-form-field class="w-full sm:w-1/3" appearance="outline">
            <mat-label>{{ 'Collection.name' | translate }}</mat-label>
            <input matInput [formControl]="nameFilter" />
            <button type="button" mat-icon-button matSuffix>
                <mat-icon>search</mat-icon>
            </button>
        </mat-form-field>

        <div class="flex pb-4 sm:w-2/3 sm:items-end sm:justify-end">
            <button
                class="mx-1 w-1/2 sm:mx-1 sm:w-1/4 lg:w-1/3"
                mat-stroked-button
                [disabled]="isCardListEmpty"
                (click)="empty()">
                {{ 'Collection.reset' | translate }}
            </button>
            <button
                class="mx-1 w-1/2 sm:mx-1 sm:w-1/4 lg:w-1/3"
                mat-flat-button
                color="primary"
                [disabled]="!isCardListSavable"
                (click)="save()">
                {{ 'Collection.add-cards' | translate }}
            </button>
        </div>
    </div>

    <div
        class="fixed absolute inset-0 z-10 flex w-screen items-center justify-center overflow-hidden"
        *ngIf="selectedCard"
        (click)="closeImage()">
        <div class="absolute z-20 flex flex-col items-center justify-center gap-4">
            <div>
                <mat-icon class="text-white">close</mat-icon>
            </div>
            <img
                [src]="selectedCard.cardInfo.imageUrl"
                [alt]="selectedCard.cardInfo.name"
                class="w-64" />
        </div>
        <div class="h-screen w-screen bg-gray-900 opacity-70"></div>
    </div>

    <div class="mat-elevation-z2">
        <table
            mat-table
            [dataSource]="cardsData"
            matSort
            (matSortChange)="announceSortChange($event)"
            class="w-full">
            <ng-container matColumnDef="show">
                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                <td mat-cell *matCellDef="let element">
                    <mat-icon
                        color="primary"
                        (click)="showImage(element)"
                        fontIcon="visibility"></mat-icon>
                </td>
            </ng-container>
            <ng-container matColumnDef="name">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    sortActionDescription="Sort by name">
                    {{ 'Collection.name' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                    <span (click)="showImage(element)">{{ element.cardInfo.name }}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="set">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    sortActionDescription="Sort by set">
                    {{ 'Collection.set' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.cardInfo.setAbbreviation }}
                </td>
            </ng-container>

            <ng-container matColumnDef="quality">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    sortActionDescription="Sort by quality">
                    {{ 'Collection.quality' | translate }}
                </th>
                <td mat-cell *matCellDef="let element">
                    <mat-form-field
                        *ngIf="displaySelect; else elseQuality"
                        appearance="outline"
                        class="w-full">
                        <mat-select
                            [(value)]="element.userInfo.qualityId"
                            (selectionChange)="setQuality(element, $event.value)">
                            <mat-option *ngFor="let quality of cardQuality" [value]="quality.id">
                                {{ quality.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <ng-template #elseQuality> {{ element.cardInfo.qualityId }}</ng-template>
                </td>
            </ng-container>

            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <button
                        matTooltip="{{ 'Collection.delete' | translate }}"
                        mat-icon-button
                        class="material-icons app-toolbar-menu delete-button"
                        (click)="removeRow(element.cardInfo.uniqueId)"
                        color="warn">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns" class="h-8"></tr>
        </table>
        <mat-paginator
            class="pb-2"
            [pageSizeOptions]="[5, 10, 20]"
            [showFirstLastButtons]="!!cardsData.data.length"></mat-paginator>
    </div>
</div>
