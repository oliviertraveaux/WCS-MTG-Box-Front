<div
    *ngIf="dataSource.data.length; else noDataSource"
    class="flex h-full w-full flex-col overflow-hidden px-4 sm:px-8 lg:px-0 lg:py-2">
    <div class="flex flex-col sm:flex-row">
        <mat-form-field class="w-full sm:w-1/3" appearance="outline">
            <mat-label>Name</mat-label>
            <input matInput [formControl]="nameFilter" />
            <button type="button" mat-icon-button matSuffix>
                <mat-icon>search</mat-icon>
            </button>
        </mat-form-field>

        <div class="flex pb-4 sm:w-2/3 sm:items-end sm:justify-end">
            <button
                class="sm:mx-1lg:w-1/3 mx-1 w-1/2 sm:w-1/4"
                mat-stroked-button
                [disabled]="isCardCollectionEmpty()"
                (click)="empty()">
                Vider
            </button>
            <button
                class="mx-1 w-1/2 sm:mx-1 sm:w-1/4 lg:w-1/3"
                mat-flat-button
                color="primary"
                [disabled]="!isCardCollectionSavable()"
                (click)="save()">
                Enregistrer
            </button>
        </div>
    </div>

    <div
        class="fixed absolute inset-0 z-10 flex h-full-header-less-mobile w-screen items-center justify-center sm:h-full-header-and-footer-less"
        *ngIf="selectedCard"
        (click)="closeImage()">
        <div class="absolute z-20 flex flex-col items-center justify-center gap-4">
            <div>
                <mat-icon class="text-white">close</mat-icon>
            </div>
            <img [src]="selectedCard.imageUrl" [alt]="selectedCard.name" class="w-64" />
        </div>
        <div class="h-screen w-screen bg-gray-900 opacity-70"></div>
    </div>

    <div class="mat-elevation-z2">
        <table
            mat-table
            [dataSource]="dataSource"
            matSort
            (matSortChange)="announceSortChange($event)"
            class="w-full">
            <ng-container matColumnDef="show">
                <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                <td mat-cell *matCellDef="let element">
                    <mat-icon
                        color="primary"
                        (click)="showImage(element)"
                        fontIcon="visibility"></mat-icon>
                </td>
            </ng-container>
            <ng-container matColumnDef="name">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    sortActionDescription="Sort by name">
                    Name
                </th>
                <td mat-cell *matCellDef="let element">
                    <span (click)="showImage(element)">{{ element.name }}</span>
                </td>
            </ng-container>

            <ng-container matColumnDef="set">
                <th
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    sortActionDescription="Sort by set">
                    Set
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.set }}
                </td>
            </ng-container>

            <ng-container matColumnDef="quality">
                <th
                    class="sm:min-w-auto min-w-24 lg:min-w-32"
                    mat-header-cell
                    *matHeaderCellDef
                    mat-sort-header
                    sortActionDescription="Sort by quality">
                    Quality
                </th>
                <td class="sm:min-w-auto min-w-24 lg:min-w-32" mat-cell *matCellDef="let element">
                    <mat-form-field class="sm:min-w-auto w-24 lg:w-32" appearance="outline">
                        <mat-select
                            [(value)]="element.quality"
                            (selectionChange)="setQuality(element, $event.value)">
                            <mat-option
                                *ngFor="let quality of Object.values(CardQuality)"
                                [value]="quality">
                                {{ quality }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let element">
                    <button
                        mat-icon-button
                        class="material-icons app-toolbar-menu delete-button"
                        (click)="removeRow(element.uniqueId)"
                        matTooltip="Delete"
                        color="warn">
                        <mat-icon>delete</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns" class="h-8"></tr>
        </table>
        <mat-paginator
            class="pb-2"
            [pageSizeOptions]="[5, 10, 20]"
            showFirstLastButtons></mat-paginator>
    </div>
    <div *ngIf="!(currentBreakpoint$ | async)?.includes(Breakpoints.Small)" class="flex-grow"></div>
</div>

<ng-template #noDataSource> Vous n'avez aucune carte dans votre liste.</ng-template>
